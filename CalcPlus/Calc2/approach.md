# Calc-2 접근 방법 및 해결 과정

Calc-2는 Calc-1에 분기문(`if/else`)과 비교식(`cond`)이 추가된 형태다.  
아래는 "구현은 하지 않고" 접근 방법과 단계별 해결 과정을 정리한 가이드다.

## 접근 방법 A: Visitor 기반 직접 평가

### 핵심 아이디어
- Calc-1에서 사용한 Visitor를 확장해 구문 트리를 내려가며 값을 바로 계산한다.
- 전역 메모리(map/dict)에 변수 값을 저장하고 재사용한다.

### 구현 전략(개념)
- `visitCalc2`: `stmt`를 순서대로 방문한다.
- `visitExprAssign`: RHS `expr`를 계산해 변수에 저장한다.
- `visitIfElse`: `cond`를 계산해 참이면 `thenBlock`만, 거짓이면 `elseBlock`만 실행한다.
- `visitBlock`: 블록 내부 `stmt`들을 순서대로 처리한다.
- `visitCond`: 좌/우 `expr`를 계산하고 비교 연산을 수행한다.
- 기존 `expr` 관련 로직은 Calc-1과 동일하게 재사용한다.

### 장점/주의사항
- 구현 난이도가 낮고 직관적이다.
- 스코프를 도입하지 않으므로 블록 내부/외부가 같은 메모리를 공유한다.
- 비교 연산(`==`, `!=`, `<`, `>`, `<=`, `>=`)만 추가하면 된다.

## 접근 방법 B: Listener + 실행 플래그 스택

### 핵심 아이디어
- ParseTreeWalker로 순회하되, 현재 블록이 실행 대상인지 여부를 스택으로 관리한다.
- 조건이 거짓인 블록에서는 `stmt`를 "무시"하도록 처리한다.

### 구현 전략(개념)
- `enterIfElse`/`exitIfElse`에서 조건 결과를 결정하고 실행 플래그를 push/pop한다.
- 중첩 `if`를 대비해 `exec_stack`(bool)을 사용한다.
- `enterExprAssign` 등에서 `exec_stack` 최상단이 `false`면 아무 동작도 하지 않는다.

### 장점/주의사항
- Listener 스타일에 맞게 한 번의 순회로 처리가 가능하다.
- 조건 결과를 계산하는 시점(enter/exit)을 명확히 설계해야 한다.
- `cond` 내부 `expr` 평가 로직은 별도 스택(값 스택)으로 관리하는 편이 안전하다.

## 접근 방법 C: AST 구성 후 평가

### 핵심 아이디어
- 1단계에서 Visitor로 AST 노드들을 생성한다.
- 2단계에서 AST 인터프리터로 실행한다.

### 장점/주의사항
- 향후 Calc-3(입출력) 확장에도 유리한 구조다.
- 코드량이 가장 많지만 구조가 가장 명확하다.

## 권장 해결 과정(단계별)

1. **문법 확인**  
   `CalcPlus/Calc2/CalcPlus.g4`에 `calc2`, `cond`, `block`, `if/else` 규칙이 포함되어 있는지 확인한다.

2. **Parser 재생성**  
   ANTLR CLI로 lexer/parser를 재생성한다.  
   - `-visitor -listener` 옵션 포함

3. **Calc-1 로직 재사용 전략 결정**  
   `CalcPlus/Calc1/calc1_visitor.py`의 `expr` 계산 로직을 그대로 활용할지,
   또는 공통 함수로 분리할지 결정한다.

4. **분기문 실행 로직 추가**  
   - `cond` 평가 결과에 따라 `thenBlock` 또는 `elseBlock`만 실행한다.
   - `else`는 선택 사항이므로 없을 때는 아무 것도 실행하지 않는다.

5. **변수 규칙 검증**  
   - 미정의 변수는 `0`으로 간주  
   - 수식 계산 중에는 변수 값이 바뀌지 않음  
   - 블록 스코프 없음(전역 메모리 사용)

6. **테스트 케이스 작성**  
   최소한 아래 케이스를 포함해 확인한다.
   - `if`만 있는 경우 / `if-else` 모두 있는 경우
   - 중첩 `if`  
   - 미정의 변수 포함 조건식  
   - 비교 연산자 6종 모두

## 빠른 체크리스트

- `cond` 비교 연산 6종 모두 지원 여부
- `else` 생략 가능 여부
- 블록 내부 `stmt` 반복 실행 여부
- 미정의 변수 `0` 처리
- 분기문 실행 시 메모리 업데이트 범위(전역)
